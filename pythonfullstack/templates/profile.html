<!-- profile.html -->
{% extends "base.html" %}
{% block content %}

<h2 class="page-title">Users List</h2>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% for cat, msg in messages %}
    {% if cat != 'book' %}
      <div class="flash-message {{ cat }}">{{ msg }}</div>
    {% endif %}
  {% endfor %}
{% endwith %}


<!-- ================= ADD USER FORM ================= -->
<div class="add-user-container">
    <h3>âž• Add User</h3>

    <form method="post" action="{{ url_for('users.add_user') }}">
        <label>Username</label>
        <input type="text" name="username" required>

        <label>Roll No</label>
        <input type="text" name="roll_no" required>

        <label>Department</label>
        <input type="text" name="department" required>

        <button type="submit">Add User</button>
    </form>
</div>

<!-- ================= USERS TABLE ================= -->
<table class="users-table">
    <thead>
        <tr>
            <th>Username</th>
            <th>Roll No</th>
            <th>Department</th>
            <th>Issue</th>
            <th>Delete User</th>
        </tr>
    </thead>

    <tbody>
        {% for user in users %}
        <tr>
            <td>{{ user[1] }}</td>
            <td>{{ user[2] }}</td>
            <td>{{ user[3] }}</td>

            
            <!-- ISSUE COLUMN -->
<td>
    {% if user[5] %}
        Issue Date: {{ user[5] }} <br>
        Return Date: {{ user[6] }}
    {% else %}
        <form method="post" action="{{ url_for('users.issue_book', user_id=user[0]) }}">
            <button type="submit">Issue</button>
        </form>
    {% endif %}
</td>



            <!-- DELETE USER -->
            <td>
                <form method="post" action="{{ url_for('users.delete_user', user_id=user[0]) }}"
                      onsubmit="return confirm('Are you sure you want to delete this user?');">
                    <button type="submit" style="background-color:#d9534f; color:white;">
                        Delete
                    </button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}