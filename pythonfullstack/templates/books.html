{% extends "base.html" %}
{% block content %}

<div class="books-wrapper">
    <h1 class="page-title">üìö Books Library</h1>
    <p style="text-align: center; color: #475569; margin-bottom: 30px;">
        Add books under categories and subcategories, view them later
    </p>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="alert {{ cat }}" style="margin-bottom: 20px;">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Add Book Form -->
    <div style="background: white; padding: 25px; border-radius: 12px; 
                box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 30px;
                border-left: 5px solid #38bdf8;">
        <h2 style="margin-top: 0; color: #1e293b;">‚ûï Add New Book</h2>
        
        <form action="{{ url_for('books.add_book_route') }}" method="POST" id="addBookForm">
            <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: end;">
                
                <!-- Category Dropdown -->
                <div style="flex: 1; min-width: 200px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b;">Category</label>
                    <select name="category" id="categorySelect" required 
                            style="width: 100%; padding: 12px; border: 2px solid #cbd5e1; 
                                   border-radius: 8px; font-size: 15px; outline: none;">
                        <option value="">Select Category</option>
                        {% for cat in categories.keys() %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>

               <!-- Subcategory Dropdown -->
<!-- Subcategory Dropdown -->
<div style="flex: 1; min-width: 200px;">
    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b;">
        Subcategory
    </label>

    <select name="subcategory" id="subcategorySelect" required
            class="book-form"
            style="width: 100%; padding: 12px; border: 2px solid #cbd5e1; 
                   border-radius: 8px; font-size: 15px; outline: none;">
        <option value="">Select Subcategory</option>
    </select>
</div>


                <!-- Book Name -->
                <div style="flex: 1; min-width: 200px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b;">Book Name</label>
                    <input type="text" name="book_name" placeholder="Book Name" required
                           style="width: 100%; padding: 12px; border: 2px solid #cbd5e1; 
                                  border-radius: 8px; font-size: 15px; outline: none;">
                </div>
                
                <!-- Author -->
                <div style="flex: 1; min-width: 200px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b;">Author</label>
                    <input type="text" name="author" placeholder="Author Name" required
                           style="width: 100%; padding: 12px; border: 2px solid #cbd5e1; 
                                  border-radius: 8px; font-size: 15px; outline: none;">
                </div>
                
                <!-- ISBN -->
                <div style="flex: 1; min-width: 150px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #1e293b;">ISBN</label>
                    <input type="text" name="isbn" placeholder="ISBN (optional)"
                           style="width: 100%; padding: 12px; border: 2px solid #cbd5e1; 
                                  border-radius: 8px; font-size: 15px; outline: none;">
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="btn-primary" style="white-space: nowrap; padding: 12px 30px;">
                    üíæ Save Book
                </button>
            </div>
        </form>
    </div>

    <!-- Main Category Grid -->
    <h2 style="text-align: center; color: #1e293b; margin-bottom: 20px;">
        üìÅ Book Categories
    </h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
                gap: 25px; margin-top: 25px;">
        
        <!-- Mathematics -->
        <a href="{{ url_for('books.category_view', category='Mathematics') }}" 
           style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                        padding: 35px; border-radius: 16px; text-align: center; 
                        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
                        transition: all 0.3s ease; cursor: pointer; color: white;">
                <div style="font-size: 56px; margin-bottom: 15px;">üìê</div>
                <h3 style="margin: 0; font-size: 24px; font-weight: 700;">Mathematics</h3>
                <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                    Algebra, Geometry & More
                </p>
            </div>
        </a>

        <!-- Physics -->
        <a href="{{ url_for('books.category_view', category='Physics') }}" 
           style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
                        padding: 35px; border-radius: 16px; text-align: center; 
                        box-shadow: 0 10px 25px rgba(245, 87, 108, 0.3);
                        transition: all 0.3s ease; cursor: pointer; color: white;">
                <div style="font-size: 56px; margin-bottom: 15px;">‚öõÔ∏è</div>
                <h3 style="margin: 0; font-size: 24px; font-weight: 700;">Physics</h3>
                <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                    Optics, Gravity & More
                </p>
            </div>
        </a>

        <!-- Computer Science -->
        <a href="{{ url_for('books.category_view', category='Computer Science') }}" 
           style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
                        padding: 35px; border-radius: 16px; text-align: center; 
                        box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
                        transition: all 0.3s ease; cursor: pointer; color: white;">
                <div style="font-size: 56px; margin-bottom: 15px;">üíª</div>
                <h3 style="margin: 0; font-size: 24px; font-weight: 700;">Computer Science</h3>
                <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                    C++, C & More
                </p>
            </div>
        </a>
    </div>
</div>

<style>
    .books-wrapper a > div:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0,0,0,0.25);
    }

    .book-form input:focus,
    .book-form select:focus {
        border-color: #38bdf8 !important;
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
    }
</style>

<!-- <script>
// Dynamic subcategory population
const categoryData = {{ categories|tojson }};

document.getElementById('categorySelect').addEventListener('change', function() {
    const category = this.value;
    const subcategorySelect = document.getElementById('subcategorySelect');
    
    // Clear existing options
    subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
    
    // Add new options
    if (category && categoryData[category]) {
        categoryData[category].forEach(function(subcat) {
            const option = document.createElement('option');
            option.value = subcat;
            option.textContent = subcat;
            subcategorySelect.appendChild(option);
        });
    }
});
</script> -->
<script>
document.getElementById("categorySelect").addEventListener("change", function () {
    const category = this.value;
    const subcatSelect = document.getElementById("subcategorySelect");

    subcatSelect.innerHTML = '<option value="">Select Subcategory</option>';

    if (category === "") return;

    fetch(`/books/get-subcategories/${category}`)
        .then(response => response.json())
        .then(data => {
            data.subcategories.forEach(subcat => {
                const option = document.createElement("option");
                option.value = subcat;
                option.textContent = subcat;
                subcatSelect.appendChild(option);
            });
        });
});
</script>

{% endblock %}