<!-- report.html -->
{% extends "base.html" %}
{% block content %}

<div class="report-page">

    <h2 class="report-title">üìä Daily Issue Report</h2>

    <!-- Search Form -->
    <form method="get" class="report-filters">
        <input type="date" name="date" value="{{ search_date }}">

        <select name="username">
            <option value="">Select User</option>
            {% for u in users %}
                <option value="{{ u['username'] }}"
                    {% if search_user == u['username'] %}selected{% endif %}>
                    {{ u['username'] }}
                </option>
            {% endfor %}
        </select>

        <button type="submit">Search</button>
    </form>

    {% if search_date or search_user %}
        <div class="report-summary">
            <span><strong>Date:</strong> {{ search_date or "All" }}</span>
            <span><strong>Total Books Issued:</strong> {{ total_issued }}</span>
        </div>
    {% endif %}

    {% if issued_books %}
        <table class="report-table">
            <thead>
                <tr>
                    <th>User Name</th>
                    <th>Book Name</th>
                    <th>Issue Date</th>
                    <th>Return Date</th>
                    <th>Status</th>
                </tr>
            </thead>

            <tbody>
            {% for row in issued_books %}
                <tr>
                    <td>{{ row.username }}</td>
                    <td>{{ row.book_name }}</td>
                    <td>{{ row.issue_date }}</td>

                    <td>
                        {% if row.actual_return_date %}
                            {{ row.actual_return_date }}
                        {% else %}
                            {{ row.expected_return_date }}
                        {% endif %}
                    </td>

                    <td>
                        {% if row.actual_return_date %}
                            <span class="status returned">‚úÖ Returned</span>
                        {% else %}
                            <span class="status issued">‚è≥ Issued</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% elif search_date or search_user %}
        <p class="no-data">No records found.</p>
    {% endif %}

</div>

{% endblock %}
